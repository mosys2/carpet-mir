@using EndPointStore.Areas.Admin.Models.ViewModelCategory;
@model ViewModelCategories;
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "ثبت دسته بندی جدید";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}
<div class="grid grid-cols-12 gap-6 mt-8">
    <div class="col-span-12 lg:col-span-4 xxl:col-span-3">
        <h2 class="intro-y text-lg font-medium mr-auto mt-2">
            ایجاد دسته بندی
        </h2>
        <!-- BEGIN: Inbox Menu -->
        <div class="intro-y box  p-5 mt-6">
            <span>افزودن دسته بندی</span>
            <div class="border-t border-theme-3 dark:border-dark-5 mt-6 pt-6">
                <form id="UserForm">
                    <input asp-for="AddCategoryView.Id" type="hidden" />
                    <div class="input-form mt-1  intro-y col-span-12 sm:col-span-6">
                        <label class="form-label w-full flex flex-col sm:flex-row"> <span class="sm:ml-auto mt-1 sm:mt-0 text-xs text-gray-600">نام دسته بندی</span></label>
                        <input asp-for="AddCategoryView.Name" type="text" class="form-control" placeholder="" required>
                        <span asp-validation-for="AddCategoryView.Name"></span>
                    </div>
                    <div class="input-form mt-3  intro-y col-span-12 sm:col-span-6">
                        <label class="form-label w-full flex flex-col sm:flex-row"> <span class="sm:ml-auto mt-1 sm:mt-0 text-xs text-gray-600">نامک</span></label>
                        <input asp-for="AddCategoryView.Slug" type="text" class="form-control" placeholder="" required>
                        <span asp-validation-for="AddCategoryView.Slug"></span>
                    </div>
                    <div class="input-form mt-3  intro-y col-span-12 sm:col-span-6">
                        <label class="form-label w-full flex flex-col sm:flex-row"> <span class="sm:ml-auto mt-1 sm:mt-0 text-xs text-gray-600">دسته بندی مادر</span></label>
                        <select  asp-for="AddCategoryView.ParentId" asp-items="@ViewBag.Category" class="form-select w-full"></select>
                    </div>
                    <div class="mt-4 intro-y col-span-12 sm:col-span-6">
                        <div class="w-full sm:w-auto flex items-center sm:ml-auto mt-3 sm:mt-0">
                            <span class="sm:ml-auto mt-1 sm:mt-0 text-xs text-gray-600">وضعیت دسته بندی</span>
                            <input asp-for="AddCategoryView.IsActive" data-target="#icon-dismiss-alert" class="show-code form-check-switch ml-0 mr-3" type="checkbox">
                        </div>
                    </div>
                    <div class="input-form mt-3 intro-y col-span-12 sm:col-span-6">
                        <label class="form-label w-full flex flex-col sm:flex-row"> <span class="sm:ml-auto mt-1 sm:mt-0 text-xs text-gray-600">توضیحات</span> </label>
                        <textarea asp-for="AddCategoryView.Description" class="form-control" placeholder=""></textarea>
                    </div>
                    <div class="mt-3 intro-y col-span-12 sm:col-span-6">
                        <button id="btn-submit"  type="submit" class="btn btn-primary w-100">ثبت</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- END: Inbox Menu -->
    </div>
    <div class="col-span-12 lg:col-span-8 xxl:col-span-9">
        <!-- BEGIN: Inbox Filter -->
        <div class="intro-y flex flex-col-reverse sm:flex-row items-center">
            <div class="w-full sm:w-auto relative ml-auto mt-3 sm:mt-0">
            </div>
            <div class="w-full sm:w-auto flex">
                <div class="dropdown">
                    <button class="dropdown-toggle btn px-2 box text-gray-700 dark:text-gray-300" aria-expanded="false">
                        <span class="w-5 h-5 flex items-center justify-center"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus w-4 h-4"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg> </span>
                    </button>
                    <div class="dropdown-menu w-40">
                        <div class="dropdown-menu__content box dark:bg-dark-1 p-2">
                            <a href="" class="flex items-center block p-2 transition duration-300 ease-in-out bg-white dark:bg-dark-1 hover:bg-gray-200 dark:hover:bg-dark-2 rounded-md"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user w-4 h-4 ml-2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg> مخاطبان </a>
                            <a href="" class="flex items-center block p-2 transition duration-300 ease-in-out bg-white dark:bg-dark-1 hover:bg-gray-200 dark:hover:bg-dark-2 rounded-md"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-settings w-4 h-4 ml-2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg> تنظیمات </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END: Inbox Filter -->
        <!-- BEGIN: Inbox Content -->
        <div  class="intro-y inbox box mt-5">
            <div class="overflow-x-auto">
                <table id="myTable" class="table table--sm">
                    <thead>
                        <tr>
                            <th class="border-b-2 dark:border-dark-5 whitespace-nowrap">نام دسته بندی</th>
                            <th class="border-b-2 dark:border-dark-5 whitespace-nowrap">نام پدر</th>
                            <th class="border-b-2 dark:border-dark-5 whitespace-nowrap">وضعیت</th>
                            <th class="border-b-2 dark:border-dark-5 whitespace-nowrap">عملیات</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.ParentCategory)
                        {
                            <tr>
                                <td class="border-b dark:border-dark-5">@item.Name</td>
                                <td class="border-b dark:border-dark-5">@item.ParentName</td>
                                @if (item.IsActive)
                                {
                                    <td class="border-b dark:border-dark-5">
                                        <div class="justify-center text-theme-9"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check-square w-4 h-4 ml-2"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg> فعال </div>
                                    </td>
                                }
                                else
                                {
                                <td class="border-b dark:border-dark-5">
                                    <div class="justify-center text-theme-6"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check-square w-4 h-4 ml-2"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg> غیرفعال </div>
                                </td>
                                }
                                <td class="border-b dark:border-dark-5">
                                   
                                    <div class="flex items-center">
                                        <button data-id="@item.Id" data-parentId="@item.ParentId" data-name="@item.OrginallName" data-slug="@item.Slug" data-isactive="@item.IsActive" data-description="@item.Description" class="btn-edit flex items-center ml-3"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check-square w-4 h-4 ml-1"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg> ویرایش</button>
                                        <button data-itemid="@item.Id" id="remove-category" class="flex items-center text-theme-6"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2 w-4 h-4 ml-1"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg> حذف </button>
                                    </div>
                                </td>
                            </tr>
                        }
                       
                    </tbody>
                </table>
            </div>
        </div>
        <!-- END: Inbox Content -->
    </div>
</div>
@section Scripts
    {

    <link href="~/AdminTemplate/assets/Sweetalert2/sweetalert2.min.css" rel="stylesheet" />
    <script src="~/AdminTemplate/assets/js/jquery.js"></script>
    <script src="~/AdminTemplate/assets/Sweetalert2/sweetalert2.min.js"></script>
    <script src="~/AdminTemplate/Library/jquery-validate/jquery.validate.min.js"></script>
    <script src="~/AdminTemplate/Library/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/AdminTemplate/Library/jquery-validate/localization/messages_fa.min.js"></script>
    <script src="~/AdminTemplate/Library/toastify-js/toastify.min.js"></script>
    <script src="~/AdminTemplate/assets/js/main.js"></script>

    <script>
            $('#UserForm').on("submit", function (e) {
                event.preventDefault();
                if ($(this).valid()) {
                    let Name = $('#AddCategoryView_Name').val()
                    let ParentId = $('#AddCategoryView_ParentId :selected').val()
                    let IsActive = $('#AddCategoryView_IsActive').is(':checked') ? true : false
                    let Slug = $('#AddCategoryView_Slug').val()
                    let Description = $('#AddCategoryView_Description').val()
                    let Id = $('#AddCategoryView_Id').val();   
                    var data = {
                     Id,Name, IsActive, Slug, Description, ParentId
                    }
                    //ajax request
                ajaxFunc("Index", data, "POST",
                        function (result) {
                            if (result.isSuccess) {
                                $("#UserForm").trigger("reset");
                                successToastify.showToast();
                            setTimeout(function () {
                                location.reload()}, 2000);
                            } else {
                                dangerToastify.showToast();
                            }
                        },
                        function (error) {
                            dangerToastify.showToast();
                            console.log(error);
                        }
                    )
                }

            });
        $(document).on('click', '#remove-category', function () {
            let currentItemId = $(this).attr('data-itemid');
            console.log(currentItemId);
            /* Read more about isConfirmed, isDenied below */
            swal.fire({
                title: 'حذف دسته بندی',
                text: "کاربر گرامی اگر دسته بندی اصلی را حذف کنید زیر دسته های مربوط به آن نیز حذف میشود آیا مطمن هستید؟",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#7cacbe',
                confirmButtonText: 'بله ، محصول حذف شود',
                cancelButtonText: 'خیر'
            }).then((result) => {
                if (result.value) {
                    var postData = {
                        'categoryId': currentItemId,
                    };
                    $.ajax({
                        contentType: 'application/x-www-form-urlencoded',
                        dataType: 'json',
                        type: "POST",
                        url: "Delete",
                        data: postData,
                        success: function (data) {
                            if (data.isSuccess == true) {
                                swal.fire(
                                    'موفق!',
                                    data.message,
                                    'success'
                                ).then(function (isConfirm) {
                                    location.reload();
                                });
                            }
                            else {

                                swal.fire(
                                    'هشدار!',
                                    data.message,
                                    'warning'
                                );

                            }
                        },
                        error: function (request, status, error) {
                            alert(request.responseText);
                        }

                    });

                }
            })
        });

        $(document).on('click', '.btn-edit', function () {
            $("#btn-submit").text("ویرایش");
            let currentItem = $(this);
            $("#AddCategoryView_Id").val(currentItem.attr("data-id"));
            var option = $('#AddCategoryView_ParentId').children();
            let parrentId = currentItem.attr("data-parentId")
            $("#AddCategoryView_Name").val(currentItem.attr("data-name"));
             $("#AddCategoryView_Slug").val(currentItem.attr("data-slug"));
            $("#AddCategoryView_Description").val(currentItem.attr("data-description"));
            if (currentItem.attr("data-isactive")=="True"){
                $("#AddCategoryView_IsActive").attr("checked","true");
            }
             else{
                    $("#AddCategoryView_IsActive").removeAttr("checked");
                }
            let valueOption = "";
            option.map((index, item) => {
                let selected = (parrentId == item.value ? "selected" : "");
                valueOption += `
                <option ${selected} value="${item.value}">${item.text}</option>`;
            });
            $('#AddCategoryView_ParentId').children().remove();
            $('#AddCategoryView_ParentId').append(valueOption);
        });
    </script>
}



